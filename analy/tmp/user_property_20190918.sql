select
  con3 category,
  count(distinct device_number) uv,
  count(*) pv
from
  user_action_context_d
where pt_days between '20190801' and '20190831'
  and model='toutiao_catgory'
group by con3;



drop table if exists tmp_user_ssy_t1;
create table tmp_user_ssy_t1 as
select substr(pt_days,0,6) pt_days,
       device_number
from
  user_action_context_d
where model in ('tencent_news_article','tencent_news_video')
  and con1 in ('20190302V0JYU900','20190302V0JYSP00','20190302V0JYQ300','20190302V0JYLQ00','20190302V0JCYP00','20190302V0JCY300','20190302V0JCXS00','20190302V0JCXA00','20190302V0JCWF00','20190301V1EP9300','20190909V0DB6M00','20190909V0DB6400','20190909V0DB5000','20190908V0BADS00','20190908V0BAD900','20190908V0BACJ00','20190907V0F86M00','20190907V0EWYO00','20190907V0EWXI00','20190907V0EMRO00','20190907V0E9O700','20190907V0E9NM00','20190906V0EC6B00','20190906V0EC5N00','20190906V0EC4S00','20190906V0EC4900','20190906V0EC3L00','20190905V0NEEV00','20190905V0NEFG00','20190905V0N0PE00','20190905V0MVFN00','20190905V0MMYE00','20190905V0MGUL00','20190905V095CD00','20190904V0MC6500','20190904V0MC5G00','20190904V0MC3U00','20190904V0M29200','20190904V0M28900','20190904V0M26000','20190303V0MPBB00','20190303V0MPBL00','20190303V0MPAI00','20190303V0M14F00','20190303V0M13Y00','20190303V0M12V00','20190303V0M13700','20190303V0M11Z00','20190302V0K7OL00','20190302V0JYVY00','20190417V0O7U900','20190417V0O7VB00','20190417V0O7VT00','20190417V0O7X400','20190417V0OED300','20190417V0OEDB00','20190418V034DO00','20190417V07WLR00','20190417V06A8S00','20190306V0QC7T00','20190419V00EOB00','20190419V00ENW00','20190418V0OV6A00','20190418V0OV6100','20190418V0OV5Q00','20190418V0OV5N00','20190418V0OV5A00','20190418V0BZ9Z00','20190418V0BZBN00','20190418V0BSZ700','20190123V08SCU00','20190123V08SAR00','20190123V08S8000','20190123V08S4G00','20190122V0PNEI00','20190122V0PNBQ00','20190122V0PN7100','20190122V0PN4800','20190122V0PMYW00','20190122V0GMJU00','20190911V0EQXW00','20190911V0EQX700','20190911V0EQWY00','20190911V0EQVZ00','20190910V0DOFL00','20190910V0DOEB00','20190910V0DOCG00','20190909V0DRKJ00','20190909V0DB8100','20190909V0DB7A00','20190306V0JXWT00','20190305V0JKZH00','20190305V0JKYT00','20190305V0J8RW00','20190305V0J8RI00','20190305V0J8R400','20190305V0J8QI00','20190305V0J8PP00','20190304V0O7PO00','20190304V0O7P500','20190122V0EC5O00','20190122V0DXRZ00','20190122V0D9IC00','20190122V0CHYV00','20190122V0BOWP00','20190122V08U1C00','20190122V083W300','20190122V083WI00','20190122V083VP00','20190121V0BALI00','20190418V0BSYI00','20190418V0BSXU00','20190418V0BSWZ00','20190418V0BSVS00','20190418V0BCYK00','20190418V0BCXZ00','20190418V0BCX300','20190418V0BCXF00','20190418V0BCW400','20190417V0O7SU00','20190301V0STZR00','20190301V0SU1100','20190301V0SLY700','20190301V0SLVW00','20190301V0SLRM00','20190301V0SLON00','20190301V0R5X500','20190301V0R5VZ00','20190301V0R5U400','20190424V01XYE00','20190424V01XY500','20190424V01XXJ00','20190423V0329500','20190423V0326Y00','20190423V0328J00','20190422V0ECGP00','20190422V0ECFP00','20190422V0ECDV00','20190419V00JOZ00','20190228V0PTBM00','20190228V0PTAZ00','20190228V0PT9U00','20190228V1542F00','20190227V10D6500','20190123V097AC00','20190123V0979P00','20190123V0979300','20190123V0978800','20190123V08SEL00','20190304V0O7OO00','20190304V0O7NV00','20190304V0NJ2I00','20190304V0NJ1600','20190304V0NJ1W00','20190304V0NJ0K00','20190304V0NIZN00','20190303V0MX8M00','20190303V0MPCE00','20190303V0MPBZ00','20190121V08VRM00','20190121V08VPN00','20190121V08VNR00','20190121V08VGV00','20190121V07ZE400','20190121V07ZDF00','20190121V07ZDV00','20190121V07ZCW00','20190120V0GGCN00','20190120V06BTA00','20190120V07XHN00','20190120V07XIK00','20190120V06BTH00','20190120V06BTP00','20190120V06BTZ00','20190120V07HIO00','20190120V07HLV00','20190120V07HH300','20190120V07HEM00','20190419V00JOT00','20190419V00JOI00','20190419V00HF000','20190419V00HEV00','20190419V00HER00','20190419V00HEL00','20190419V00HEE00','20190419V00EP500','20190419V00EOV00','20190419V00EOJ00','20190301V0R5NV00','20190228V0QVM900','20190228V0QVOY00','20190228V0QIMV00','20190228V0QIKZ00','20190228V0QIIO00','20190228V0QIGI00','20190228V0QIDV00','20190228V0PTD000','20190228V0PTC500','90PQCU1ZG001WQB7000','90PQ8LQJG001W0EQ000','90PQ75N4G001VSDM000','90PQ6YCRG001VQOF000','90PQ51F9G001VD9D000','90PQ4PVNG001VAAF000','90PPZM42G001U624000','90PNU4C5G001H15X000','90PNRWS2G001GM6D000','90PNR1Z6G001GIC8000','90PNQ5YOG001GDJO000','90PNQ5UAG001GDIT000','90PNQ5MKG001GDHG000','90PNOHW1G001G4CT000','90PNO67VG001G2C9000','90PNMXRAG001FWJK000','90PLQ6BLG0016C83000','90PLQ65DG0016C62000','90PLLTE8G0015LB0000','90PLLTBAG0015LA8000','90PLK4FIG0015BIF000','90PLK37HG0015B7T000','90PLJ2RIG00154BE000','90PLIRJPG001521N000','90PLGZ6PG0014RRI000','90PKUW6BG0011DAO000','90PKUPKQG0011C58000','90PKUKNSG0011B9W000','90PKUJSVG0011B5A000','90PKSWOHG00112M7000','90PKSVJNG00112E2000','90PKSL01G00110DH000','90PKRBWWG0010SS9000','90PKRBR6G0010SQE000','90PKRAVTG0010SJC000','90PKR4V9G0010RD1000','90PKP455G0010FIO000')
group by
  substr(pt_days,0,6),
  device_number;



select '十三邀-腾讯新闻' model,
       t.pt_days,
       count(distinct t.device_number) uv,
       sum(t.pv) pv,
       sum(t.active_days) active_days
    from
      user_action_app_m t,tmp_user_ssy_t1 t1
    where t.pt_days=t1.pt_days
      and t.device_number=t1.device_number
      and t.appname='tencent_news'
    group by
       t.pt_days;

select  '腾讯新闻' model,
        t.pt_days,
        count(distinct t.device_number) uv,
        sum(t.pv) pv,
        sum(t.active_days) active_days
   from
     user_action_app_m t
   where t.appname='tencent_news'
   group by
      pt_days;

drop table if exists tmp_user_app_profile_t3;
create table tmp_user_app_profile_t3 as
select
       device_number
from
  user_action_context_d
where model in ('tencent_news_article','tencent_news_video')
  and con1 in ('20190302V0JYU900','20190302V0JYSP00','20190302V0JYQ300','20190302V0JYLQ00','20190302V0JCYP00','20190302V0JCY300','20190302V0JCXS00','20190302V0JCXA00','20190302V0JCWF00','20190301V1EP9300','20190909V0DB6M00','20190909V0DB6400','20190909V0DB5000','20190908V0BADS00','20190908V0BAD900','20190908V0BACJ00','20190907V0F86M00','20190907V0EWYO00','20190907V0EWXI00','20190907V0EMRO00','20190907V0E9O700','20190907V0E9NM00','20190906V0EC6B00','20190906V0EC5N00','20190906V0EC4S00','20190906V0EC4900','20190906V0EC3L00','20190905V0NEEV00','20190905V0NEFG00','20190905V0N0PE00','20190905V0MVFN00','20190905V0MMYE00','20190905V0MGUL00','20190905V095CD00','20190904V0MC6500','20190904V0MC5G00','20190904V0MC3U00','20190904V0M29200','20190904V0M28900','20190904V0M26000','20190303V0MPBB00','20190303V0MPBL00','20190303V0MPAI00','20190303V0M14F00','20190303V0M13Y00','20190303V0M12V00','20190303V0M13700','20190303V0M11Z00','20190302V0K7OL00','20190302V0JYVY00','20190417V0O7U900','20190417V0O7VB00','20190417V0O7VT00','20190417V0O7X400','20190417V0OED300','20190417V0OEDB00','20190418V034DO00','20190417V07WLR00','20190417V06A8S00','20190306V0QC7T00','20190419V00EOB00','20190419V00ENW00','20190418V0OV6A00','20190418V0OV6100','20190418V0OV5Q00','20190418V0OV5N00','20190418V0OV5A00','20190418V0BZ9Z00','20190418V0BZBN00','20190418V0BSZ700','20190123V08SCU00','20190123V08SAR00','20190123V08S8000','20190123V08S4G00','20190122V0PNEI00','20190122V0PNBQ00','20190122V0PN7100','20190122V0PN4800','20190122V0PMYW00','20190122V0GMJU00','20190911V0EQXW00','20190911V0EQX700','20190911V0EQWY00','20190911V0EQVZ00','20190910V0DOFL00','20190910V0DOEB00','20190910V0DOCG00','20190909V0DRKJ00','20190909V0DB8100','20190909V0DB7A00','20190306V0JXWT00','20190305V0JKZH00','20190305V0JKYT00','20190305V0J8RW00','20190305V0J8RI00','20190305V0J8R400','20190305V0J8QI00','20190305V0J8PP00','20190304V0O7PO00','20190304V0O7P500','20190122V0EC5O00','20190122V0DXRZ00','20190122V0D9IC00','20190122V0CHYV00','20190122V0BOWP00','20190122V08U1C00','20190122V083W300','20190122V083WI00','20190122V083VP00','20190121V0BALI00','20190418V0BSYI00','20190418V0BSXU00','20190418V0BSWZ00','20190418V0BSVS00','20190418V0BCYK00','20190418V0BCXZ00','20190418V0BCX300','20190418V0BCXF00','20190418V0BCW400','20190417V0O7SU00','20190301V0STZR00','20190301V0SU1100','20190301V0SLY700','20190301V0SLVW00','20190301V0SLRM00','20190301V0SLON00','20190301V0R5X500','20190301V0R5VZ00','20190301V0R5U400','20190424V01XYE00','20190424V01XY500','20190424V01XXJ00','20190423V0329500','20190423V0326Y00','20190423V0328J00','20190422V0ECGP00','20190422V0ECFP00','20190422V0ECDV00','20190419V00JOZ00','20190228V0PTBM00','20190228V0PTAZ00','20190228V0PT9U00','20190228V1542F00','20190227V10D6500','20190123V097AC00','20190123V0979P00','20190123V0979300','20190123V0978800','20190123V08SEL00','20190304V0O7OO00','20190304V0O7NV00','20190304V0NJ2I00','20190304V0NJ1600','20190304V0NJ1W00','20190304V0NJ0K00','20190304V0NIZN00','20190303V0MX8M00','20190303V0MPCE00','20190303V0MPBZ00','20190121V08VRM00','20190121V08VPN00','20190121V08VNR00','20190121V08VGV00','20190121V07ZE400','20190121V07ZDF00','20190121V07ZDV00','20190121V07ZCW00','20190120V0GGCN00','20190120V06BTA00','20190120V07XHN00','20190120V07XIK00','20190120V06BTH00','20190120V06BTP00','20190120V06BTZ00','20190120V07HIO00','20190120V07HLV00','20190120V07HH300','20190120V07HEM00','20190419V00JOT00','20190419V00JOI00','20190419V00HF000','20190419V00HEV00','20190419V00HER00','20190419V00HEL00','20190419V00HEE00','20190419V00EP500','20190419V00EOV00','20190419V00EOJ00','20190301V0R5NV00','20190228V0QVM900','20190228V0QVOY00','20190228V0QIMV00','20190228V0QIKZ00','20190228V0QIIO00','20190228V0QIGI00','20190228V0QIDV00','20190228V0PTD000','20190228V0PTC500','90PQCU1ZG001WQB7000','90PQ8LQJG001W0EQ000','90PQ75N4G001VSDM000','90PQ6YCRG001VQOF000','90PQ51F9G001VD9D000','90PQ4PVNG001VAAF000','90PPZM42G001U624000','90PNU4C5G001H15X000','90PNRWS2G001GM6D000','90PNR1Z6G001GIC8000','90PNQ5YOG001GDJO000','90PNQ5UAG001GDIT000','90PNQ5MKG001GDHG000','90PNOHW1G001G4CT000','90PNO67VG001G2C9000','90PNMXRAG001FWJK000','90PLQ6BLG0016C83000','90PLQ65DG0016C62000','90PLLTE8G0015LB0000','90PLLTBAG0015LA8000','90PLK4FIG0015BIF000','90PLK37HG0015B7T000','90PLJ2RIG00154BE000','90PLIRJPG001521N000','90PLGZ6PG0014RRI000','90PKUW6BG0011DAO000','90PKUPKQG0011C58000','90PKUKNSG0011B9W000','90PKUJSVG0011B5A000','90PKSWOHG00112M7000','90PKSVJNG00112E2000','90PKSL01G00110DH000','90PKRBWWG0010SS9000','90PKRBR6G0010SQE000','90PKRAVTG0010SJC000','90PKR4V9G0010RD1000','90PKP455G0010FIO000')
group by
  device_number;


drop table if exists tmp_user_app_profile_t4;
create table tmp_user_app_profile_t4 as
select * from
    (select t.*,
        row_number() over(partition by device_number order by age_range desc) rn
    from user_info_sample t  where pt_days='201907') a
where rn=1;



--  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -头条内容点击属性分布-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --


select  '十三邀' app,
        '常驻省份分布' model,
        t1.top1_home_province,
        count(*) cnt
    from
        tmp_user_app_profile_t3 t
     left join
        tmp_user_app_profile_t4 t1
    on t.device_number=t1.device_number
    group by t1.top1_home_province;

select '-- -- -*******************************************************************************************************************-- -- -';

select  '十三邀' app,
        '常驻城市分布' model,
        t1.top1_home_city,
        count(*) cnt
    from
       tmp_user_app_profile_t3  t
     left join
        tmp_user_app_profile_t4 t1
    on t.device_number=t1.device_number
    group by t1.top1_home_city;
select '-- -- -*******************************************************************************************************************-- -- -';

select  '十三邀' app,
        '品牌分布' model,
        t1.factory_desc,
        count(*) cnt
    from
      tmp_user_app_profile_t3 t
    left join
        tmp_user_app_profile_t4 t1
    on t.device_number=t1.device_number
    group by t1.factory_desc;

select '-- -- -*******************************************************************************************************************-- -- -';

select  '十三邀' app,
        '证件归属地分布' model,
        t1.cert_prov,
        count(*) cnt
    from
      tmp_user_app_profile_t3 t
     left join
        tmp_user_app_profile_t4 t1
    on t.device_number=t1.device_number
    group by t1.cert_prov;

select '-- -- -*******************************************************************************************************************-- -- -';

select  '十三邀' app,
        '性别分布' model,
        t1.cust_sex,
        count(*) cnt
    from
        tmp_user_app_profile_t3 t
     left join
        tmp_user_app_profile_t4 t1
    on t.device_number=t1.device_number
    group by t1.cust_sex;

select '-- -- -*******************************************************************************************************************-- -- -';

select  '十三邀' app,
        '消费水平分布' model,
        t1.cost_level,
        count(*) cnt
    from
        tmp_user_app_profile_t3 t
     left join
        tmp_user_app_profile_t4 t1
    on t.device_number=t1.device_number
    group by t1.cost_level;

select '-- -- -*******************************************************************************************************************-- -- -';

select  '十三邀' app,
        '年龄分布' model,
        t1.age_range,
        count(*) cnt
    from
        tmp_user_app_profile_t3 t
     left join
        tmp_user_app_profile_t4 t1
    on t.device_number=t1.device_number
    group by t1.age_range;


drop table if exists tmp_user_ssy_t1;
drop table if exists tmp_user_app_profile_t3;
drop table if exists tmp_user_app_profile_t4;
